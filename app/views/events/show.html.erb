<%
  venue = Venue.find_by(:id => @event.venueid) 
  team = @event.teamid.blank? ? nil : Team.find_by(:id => @event.teamid)
  opponent = @event.opponentid.blank? ? nil : Opponent.find_by(:id => @event.opponentid)
  result = Result.find_by(:event_id => @event.id) 

  case @event.status
    when /^(scheduled|postponed|rescheduled|canceled)$/
      status = @event.status.camelize
    else
      status = 'scheduled'.camelize
  end
%>

<ul data-role="listview" data-inset="true">
  <li data-role="list-divider">
    <% title = "title" %>
    <% subtitle = "subtitle" %>
    <% title, subtitle = @event.formalname %>
    <h1><%= title %></h1>
    <% if !subtitle.blank? %>
      <h4><%= subtitle %></h4>
    <% end %>
    <% if !result.nil? %>
      <h4>Result:  <%= result.resulttext[0] %></h4>
      <% if !result.notes.blank? %>
        <p>Notes:  <%= result.notes %></p>
      <% end %>
    <% end %>
    <p>Scheduled:  <%= @event.datetimelong %></p>
    <p>Duration (est):  <%= distance_of_time_in_words(@event.eventduration * 60) %></p>
    <p>Status:  <span class="event-<%= status.downcase %>"><%= status %></span></p>
    <% if !@event.notes.blank? %>
      <p>Notes:  <%= @event.notes %></p>
    <% end %>
  </li>
  <% if !team.nil? %>
  <li><%= link_to sprintf("Team:  %s", team.formalname), team_path(team) %></li>
  <% end %>
  <% if !@event.opponentid.blank? %>
    <li><%= link_to sprintf("Opponent:  %s", opponent.name), opponent_path(opponent) %><span class="ui-li-count-fix ui-li-count"><%= opponent.conferenceopponent ? "C" : "N" %></span></li>
  <% end %>
  <% if !@event.opponents.blank? && @event.opponents.count > 1 %>
    <% @event.opponents.each do |o| %>
      <% if !o.blank? %>
        <% opponent = Opponent.find_by(:id => o) %>
        <li><%= link_to sprintf("Opponent:  %s", opponent.name), opponent_path(opponent) %><span class="ui-li-count-fix ui-li-count"><%= opponent.conferenceopponent ? "C" : "N" %></span></li>
      <% end %>
    <% end %>
  <% end %>
  <li><%= link_to sprintf("Venue:  %s", venue.name), venue_path(venue) %><span class="ui-li-count-fix ui-li-count"><%= @event.eventlocation.camelize[0] %></span></li>
</ul>

<div data-role="controlgroup" data-type="horizontal" data-mini="true">
  <a data-icon="back" data-role="button" class="ui-corner-all" data-rel="back">Back</a>
  <%= link_to 'Back to Events', events_path, :'data-role' => 'button', :'data-icon' => "back", :class => "ui-corner-all" %>
</div>
<% if current_user.try(:admin?) %>
  <div data-role="controlgroup" data-type="horizontal" data-mini="true">
    <%= link_to 'Update Event', edit_event_path(@event), :'data-role' => 'button', :'data-icon' => 'edit', :class => 'ui-corner-all' %>
    <% result = @event.getresult %>
    <% if result.nil? %>
      <%= link_to 'Report Result', new_result_path(:event_id => @event.id), :'data-role' => 'button', :'data-icon' => 'plus', :'data-inline' => 'false' %>
    <% else %>
      <%= link_to 'Update Result', edit_result_path(:event_id => @event.id, :id => result.id), :'data-role' => 'button', :'data-icon' => 'edit', :'data-inline' => 'false' %>
    <% end %>
    <%= link_to 'Add Event', new_event_path, :'data-role' => 'button', :'data-icon' => 'plus', :'data-inline' => "false" %>
  </div>
<% end %>
